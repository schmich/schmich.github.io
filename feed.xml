<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>subrational</title>
    <description></description>
    <link>http://subrational.com</link>
    <atom:link href="http://subrational.com/feed.xml" rel="self" type="application/rss+xml" />
    
      <item>
        <title>HTML5 video: Content-Type is important</title>
        <description>&lt;p&gt;If you&amp;#8217;re trying to play HTML5 video with the &lt;code&gt;&amp;lt;video/&amp;gt;&lt;/code&gt; tag, ensure the correct &lt;code&gt;Content-Type&lt;/code&gt; header is being sent for your source media.&lt;/p&gt;

&lt;p&gt;Some browsers, such as Chrome, seem willing to play a video regardless of its &lt;code&gt;Content-Type&lt;/code&gt; (perhaps through sniffing or file extensions), but others, such as IE, require a valid and supported value.&lt;/p&gt;

&lt;p&gt;I ran into this while trying to play videos hosted on S3 with IE10:&lt;/p&gt;
&lt;div class='highlight'&gt;&lt;pre&gt;&lt;code class='html'&gt;&lt;span class='nt'&gt;&amp;lt;video&lt;/span&gt; &lt;span class='na'&gt;controls&lt;/span&gt; &lt;span class='na'&gt;autoplay&lt;/span&gt;&lt;span class='nt'&gt;&amp;gt;&lt;/span&gt;
  &lt;span class='nt'&gt;&amp;lt;source&lt;/span&gt; &lt;span class='na'&gt;src=&lt;/span&gt;&lt;span class='s'&gt;&amp;quot;http://s3-us-west-1.amazonaws.com/foo/bar.mp4&amp;quot;&lt;/span&gt; &lt;span class='na'&gt;type=&lt;/span&gt;&lt;span class='s'&gt;&amp;quot;video/mp4&amp;quot;&lt;/span&gt; &lt;span class='nt'&gt;/&amp;gt;&lt;/span&gt;
&lt;span class='nt'&gt;&amp;lt;/video&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Even with the &lt;code&gt;type&lt;/code&gt; attribute set to &lt;code&gt;video/mp4&lt;/code&gt;, IE refused to play the video, saying only &amp;#8220;Invalid Source&amp;#8221; or &amp;#8220;Error: Unsupported video type or invalid file path&amp;#8221;. Some searching yielded &lt;a href='http://blogs.msdn.com/b/thebeebs/archive/2011/07/20/html5-video-not-working-in-ie9-some-tips-to-debug.aspx'&gt;this blog post&lt;/a&gt; detailing common problems.&lt;/p&gt;

&lt;p&gt;The error coming from the video element in IE was &lt;code&gt;MEDIA_ERR_SRC_NOT_SUPPORTED&lt;/code&gt;. In my case, the source wasn&amp;#8217;t supported because the MIME type being sent was not supported:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl -I http://s3-us-west-1.amazonaws.com/foo/bar.mp4
HTTP/1.1 200 OK
Date: Fri, 14 Jun 2013 03:24:53 GMT
Last-Modified: Fri, 14 Jun 2013 03:24:40 GMT
Content-Type: application/octet-stream
Content-Length: 9227881
Server: AmazonS3
...&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Apparently after uploading the video, S3 automatically set its &lt;code&gt;Content-Type&lt;/code&gt; to &lt;code&gt;application/octet-stream&lt;/code&gt;, which IE does not support.&lt;/p&gt;

&lt;p&gt;This is normally not a problem when serving videos from a web server such as Apache, since the server is usually configured to send the &lt;code&gt;Content-Type&lt;/code&gt; header based on the file extension, but many cloud storage services like S3 require you to specify your own metadata.&lt;/p&gt;

&lt;p&gt;We were uploading videos using the &lt;a href='http://aws.amazon.com/sdkforruby/'&gt;AWS Ruby SDK&lt;/a&gt;, so the fix was to simply specify &lt;code&gt;:content-type&lt;/code&gt; when uploading the file via &lt;a href='http://docs.aws.amazon.com/AWSRubySDK/latest/AWS/S3/S3Object.html#write-instance_method'&gt;S3Object#write&lt;/a&gt;:&lt;/p&gt;
&lt;div class='highlight'&gt;&lt;pre&gt;&lt;code class='ruby'&gt;&lt;span class='n'&gt;obj&lt;/span&gt;&lt;span class='o'&gt;.&lt;/span&gt;&lt;span class='n'&gt;write&lt;/span&gt;&lt;span class='p'&gt;(&lt;/span&gt;&lt;span class='ss'&gt;:content_type&lt;/span&gt; &lt;span class='o'&gt;=&amp;gt;&lt;/span&gt; &lt;span class='s1'&gt;&amp;#39;video/mp4&amp;#39;&lt;/span&gt;&lt;span class='p'&gt;,&lt;/span&gt; &lt;span class='o'&gt;.&lt;/span&gt;&lt;span class='n'&gt;.&lt;/span&gt;&lt;span class='o'&gt;.&lt;/span&gt;&lt;span class='p'&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you need to support a wider range of MIME types, consider using the &lt;a href='https://github.com/halostatue/mime-types'&gt;mime-types&lt;/a&gt; gem and &lt;code&gt;MIME::Types.type_for&lt;/code&gt;.&lt;/p&gt;</description>
        <pubDate>Mon, 05 Aug 2013 00:00:00 -0700</pubDate>
        <link>http://subrational.com/2013/08/05/html5-video-content-type-is-important/</link>
        <guid isPermaLink="true">http://subrational.com/2013/08/05/html5-video-content-type-is-important/</guid>
      </item>
    
  </channel>
</rss>
